---
title: "ğŸ“ PrÃ¡ctica 3"
output: 
  flexdashboard::flex_dashboard:
    theme:
      bg: "#101010"
      fg: "#FDF7F7" 
      primary: "#5C8374"
      base_font:
        google: Prompt
      code_font:
        google: JetBrains Mono
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
if (!require("flexdashboard")) install.packages("flexdashboard")
if (!require("DT")) install.packages("DT")
library(tidyverse)
library(dplyr)
library(flexdashboard)
library(DT)
library(highcharter)
load("_data/datos_completos.RData")
```
âš™ï¸ 1: PreparaciÃ³n de los datos
=======================================================================
Procesamos los CSV en otro archivo y aqui solo leemos los dataframe

Column {data-width=650 .tabset}
-----------------------------------------------------------------------
### ğŸ“Š Datos completos

```{r}
datatable(df_datos_completos)
```

### ğŸ§‘â€ğŸ¤â€ğŸ§‘ Clientes

```{r}
datatable(df_clientes)
```

### ğŸ› ï¸  Servicios

```{r}
datatable(df_servicios)
```

### ğŸ’°ï¸ Tramsacciones

```{r}
datatable(df_transacciones)
```
### ğŸ“¢ï¸ CampaÃ±as

```{r}
datatable(df_campanias)
```

Column {data-width=350}
-----------------------------------------------------------------------
â„¹ï¸ DefiniciÃ³n

### STR

```{r}
str(df_datos_completos)
```

### ğŸ“ˆ Summary

```{r}
summary(df_datos_completos)
```
ğŸ“Š 2: Visualizaciones interactivas
=======================================================================

Column {.tabset}
-----------------------------------------------------------------------

### âœ… 1. Ventas por CategorÃ­a de Servicio

```{r}
df_datos_completos %>%
  group_by(categorÃ­a) %>%
  summarise(ventas_totales = sum(total, na.rm = TRUE)) %>%
  hchart("column", hcaes(x = categorÃ­a, y = ventas_totales)) %>%
  hc_title(text = "Ventas por CategorÃ­a de Servicio") %>%
  hc_xAxis(title = list(text = "CategorÃ­a")) %>%
  hc_yAxis(title = list(text = "Total en Bs"))
```
### ğŸ“Š 2. DistribuciÃ³n de Clientes por Edad
```{r}
hchart(
  hist(df_datos_completos$edad, breaks = seq(0, 100, by = 5), plot = FALSE),
  color = "#3182bd"
) %>%
  hc_title(text = "DistribuciÃ³n de Edad de Clientes") %>%
  hc_xAxis(title = list(text = "Edad")) %>%
  hc_yAxis(title = list(text = "Frecuencia"))

```
### ğŸ“ 3. Ventas por Departamento
```{r}
df_datos_completos %>%
  group_by(departamento) %>%
  summarise(ventas_totales = sum(total, na.rm = TRUE)) %>%
  arrange(desc(ventas_totales)) %>%  # Ordena de mayor a menor
  hchart("bar", hcaes(x = departamento, y = ventas_totales, color = ventas_totales)) %>%
  hc_title(text = "Ventas por Departamento") %>%
  hc_xAxis(title = list(text = "Departamento")) %>%
  hc_yAxis(title = list(text = "Total en Bs")) %>%
  hc_colors(c("#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2")) %>%
  hc_legend(enabled = TRUE, title = list(text = "Departamentos"))
```

### ğŸš» 4. Ventas por GÃ©nero
```{r}
df_datos_completos %>%
  group_by(genero) %>%
  summarise(ventas_totales = sum(total, na.rm = TRUE)) %>%
  hchart("pie", hcaes(x = genero, y = ventas_totales), 
         color = c("#1f77b4", "#ff7f0e", "#2ca02c")) %>%
  hc_title(text = "Ventas por GÃ©nero") %>%
  hc_tooltip(pointFormat = "{series.name}: <b>{point.percentage:.1f}%</b>")
```

### ğŸŒ† 5. ParticipaciÃ³n por Ciudad
```{r}
df_datos_completos %>%
  count(ciudad, name = "total_clientes") %>%
  hchart("bar", hcaes(x = ciudad, y = total_clientes)) %>%
  hc_title(text = "ParticipaciÃ³n por Ciudad") %>%
  hc_xAxis(title = list(text = "Ciudad")) %>%
  hc_yAxis(title = list(text = "Cantidad de Clientes"))
```

### ğŸ“ˆ 6. Tendencias de Ventas por Fecha

```{r}
df_datos_completos %>%
  mutate(fecha = ymd(fecha)) %>%
  group_by(fecha) %>%
  summarise(ventas_totales = sum(total)) %>%
  hchart("line", hcaes(x = fecha, y = ventas_totales)) %>%
  hc_title(text = "Tendencia de Ventas por Fecha") %>%
  hc_xAxis(type = "datetime", title = list(text = "Fecha")) %>%
  hc_yAxis(title = list(text = "Total en Bs"))

```

### ğŸ“Š 7. Histograma de Frecuencia de Ventas

```{r}
hchart(
  hist(df_datos_completos$total, plot = FALSE),
  color = "#a1d99b"
) %>%
  hc_title(text = "Histograma de Frecuencia de Ventas") %>%
  hc_xAxis(title = list(text = "Monto Total (Bs)")) %>%
  hc_yAxis(title = list(text = "Frecuencia"))

```

### ğŸŸ  8. DispersiÃ³n entre Edad y Monto de Venta

```{r}
hchart(df_datos_completos, "scatter", hcaes(x = edad, y = total)) %>%
  hc_title(text = "DispersiÃ³n entre Edad y Monto de Venta") %>%
  hc_xAxis(title = list(text = "Edad del Cliente")) %>%
  hc_yAxis(title = list(text = "Monto de la TransacciÃ³n (Bs)"))
```

ğŸ§­ï¸ 3: VisualizaciÃ³n geoespacial con rutas
=======================================================================

Row
-----------------------------------------------------------------------
### Chart 1
```{r}
str(df_campanias)
```

ğŸ“ˆ 4: KPIs {data-orientation=rows}
=======================================================================

Row
-----------------------------------------------------------------------
```{r setup1, include=FALSE}

# Total de ingresos generados
total_ingresos <- sum(df_datos_completos$total, na.rm = TRUE)

# Total de clientes Ãºnicos
total_clientes <- n_distinct(df_datos_completos$id_cliente)

# Total de transacciones
total_transacciones <- nrow(df_datos_completos)

# Servicio mÃ¡s solicitado
servicio_top <- df_datos_completos %>%
  count(nombre_servicio, sort = TRUE) %>%
  slice(1) %>%
  pull(nombre_servicio)

# Departamento con mÃ¡s ventas
departamento_top <- df_datos_completos %>%
  group_by(departamento) %>%
  summarise(ventas = sum(total, na.rm = TRUE)) %>%
  arrange(desc(ventas)) %>%
  slice(1) %>%
  pull(departamento)

```

### Total de ingresos
```{r}
valueBox(formatC(total_ingresos, format = "f", big.mark = ",", digits = 2), "Total de ingresos", icon = "fa-dollar-sign")
```

### Clientes Ãºnicos
```{r}
valueBox(total_clientes, "Clientes Ãºnicos", icon = "fa-users")
```

Row
-----------------------------------------------------------------------
### Transacciones
```{r}
valueBox(total_transacciones, "Transacciones", icon = "fa-exchange-alt")
```

### Servicio mÃ¡s solicitado
```{r}
valueBox(servicio_top, "Servicio mÃ¡s solicitado", icon = "fa-cogs")
```
### Departamento lÃ­der
```{r}
valueBox(departamento_top, "Departamento lÃ­der", icon = "fa-map-marked-alt")
```


ğŸ“ 5: CrÃ©ditos
=======================================================================

**ğŸ“„ Informe de VisualizaciÃ³n de Datos**

- ğŸ‘¨â€ğŸ“ **Nombre del Estudiante:** Gaston Nina Sossa  
- ğŸ§‘â€ğŸ’» **Carrera:** IngenierÃ­a de Sistemas  
- ğŸ“Š **MÃ³dulo:** VisualizaciÃ³n de Datos  
- ğŸ“ **Universidad:** Universidad Mayor de San AndrÃ©s  
- ğŸ‘¨â€ğŸ« **Docente:** David ..  
- ğŸ“… **GestiÃ³n:** 2024 - Segundo Semestre
